----------
ORDER
----------

í”„ë¡œì íŠ¸ êµ¬ì¡°
project_name/
â”œâ”€â”€ .github/                # ê¹ƒí—ˆë¸Œ ì„¤ì • íŒŒì¼ ( ì»¤ë°‹í…œí”Œë¦¿, ì´ìŠˆí…œí”Œë¦¿, pr í…œí”Œë¦¿, CI / CD ë“± )
â”‚   â”œâ”€â”€ COMMIT_TEMPLATE/    # í•˜ìœ„ì— ì»¤ë°‹ í…œí”Œë¦¿ì„ ì •ì˜
â”‚   â”œâ”€â”€ ISSUE_TEMPLATE/     # í•˜ìœ„ì— ì´ìŠˆí…œí”Œë¦¿ì„ ì •ì˜
â”‚   â””â”€â”€ workflows/          # í•˜ìœ„ì— CI / CD ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì •ì˜
â”‚       â”œâ”€â”€ checks.yml     # develop ë˜ëŠ” main ë¸Œëœì¹˜ì— Push ë˜ëŠ” PR Merge ì‹œ ë°ì´í„° ë² ì´ìŠ¤ ì—°ê²° í™•ì¸, ì½”ë“œ í¬ë§¤íŒ… ì²´í¬, í…ŒìŠ¤íŠ¸ í†µê³¼ ì—¬ë¶€ë¥¼ ê²€ì‚¬í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
â”‚       â””â”€â”€ deploy.yml     # develop ë˜ëŠ” main ë¸Œëœì¹˜ì— Push ë˜ëŠ” Mergeì‹œ ë°°í¬ ìë™í™”ë¥¼ êµ¬í˜„í•œ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ config/                 # í”„ë¡œì íŠ¸ ì„¤ì • íŒŒì¼ (settings, urls ë“±)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ asgi.py
â”‚   â”œâ”€â”€ settings.py
â”‚   â”œâ”€â”€ urls.py
â”‚   â””â”€â”€ wsgi.py
â”œâ”€â”€ apps/                   # ì•± ë””ë ‰í† ë¦¬ (ì•±ë³„ë¡œ ë””ë ‰í† ë¦¬ë¥¼ ë‚˜ëˆ”)
â”‚   â”œâ”€â”€ app_name1/
â”‚   â”‚   â”œâ”€â”€ migrations/     # ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼
â”‚   â”‚   â”œâ”€â”€ services/       # ì•±ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì„œë¹„ìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ëŠ” í´ë”
â”‚   â”‚   â”œâ”€â”€ repository/     # ì•±ì˜ ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ì— ê´€ë ¨ëœ CRUD ë™ì‘ì„ ì •ì˜í•˜ëŠ” í´ë”
â”‚   â”‚   â”œâ”€â”€ admin.py        # Django Admin ê´€ë ¨ ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ apps.py         # ì•± ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ models.py       # ëª¨ë¸ ì •ì˜
â”‚   â”‚   â”œâ”€â”€ tests.py        # í…ŒìŠ¤íŠ¸ ì½”ë“œ
â”‚   â”‚   â”œâ”€â”€ urls.py         # ì•± ì „ìš© URL ë¼ìš°íŒ…
â”‚   â”‚   â””â”€â”€ views.py        # ë·° ë¡œì§
â”‚   â”œâ”€â”€ app_name2/          # ë‹¤ë¥¸ ì•±
â”‚   â”‚   â”œâ”€â”€ migrations/     # ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼
â”‚   â”‚   â”œâ”€â”€ services/       # ì•±ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì„œë¹„ìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ëŠ” í´ë”
â”‚   â”‚   â”œâ”€â”€ repository/     # ì•±ì˜ ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ì— ê´€ë ¨ëœ CRUD ë™ì‘ì„ ì •ì˜í•˜ëŠ” í´ë”
â”‚   â”‚   â”œâ”€â”€ admin.py        # Django Admin ê´€ë ¨ ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ apps.py         # ì•± ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ models.py       # ëª¨ë¸ ì •ì˜
â”‚   â”‚   â”œâ”€â”€ tests.py        # í…ŒìŠ¤íŠ¸ ì½”ë“œ
â”‚   â”‚   â”œâ”€â”€ urls.py         # ì•± ì „ìš© URL ë¼ìš°íŒ…
â”‚   â”‚   â””â”€â”€ views.py        # ë·° ë¡œì§
â”‚   â””â”€â”€ ...
â”œâ”€â”€ envs/                   # í™˜ê²½ë³€ìˆ˜ íŒŒì¼ë“¤
â”‚   â”œâ”€â”€ .env                # ë¡œì»¬ ë° ë°°í¬ í™˜ê²½ì—ì„œ ì„œë²„ êµ¬ë™ ë° í…ŒìŠ¤íŠ¸ ì‹œ í•„ìš”í•œ í™˜ê²½ë³€ìˆ˜
â”‚   â””â”€â”€ .env.prod           # ë°°í¬ í™˜ê²½ì—ì„œ ì„œë²„ êµ¬ë™ ë° í…ŒìŠ¤íŠ¸ ì‹œ í•„ìš”í•œ í™˜ê²½ë³€ìˆ˜
â”œâ”€â”€ resources/              # ì´ˆê¸° ì„¤ì • íŒŒì¼ ë° ìŠ¤í¬ë¦½íŠ¸, nginx, docker, kubernetes ì˜ yaml íŒŒì¼
â”‚   â”œâ”€â”€ nginx/
â”‚   â”‚   â””â”€â”€ nginx.conf      # ëª¨ë¸ ì •ì˜
â”‚   â”œâ”€â”€ docker/
â”‚   â”‚   â”œâ”€â”€ dockerfile      # ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ íŒŒì¼
â”‚   â”‚   â””â”€â”€ docker-compose.yml   # ë„ì»¤ ì»¨í…Œì´ë„ˆ ì •ì˜ íŒŒì¼
â”‚   â”œâ”€â”€ kubernetes/
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ entrypoint.sh   # ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ ì‹œ ìµœì¢…ì ìœ¼ë¡œ ì‹¤í–‰ë  ìŠ¤í¬ë¦½íŠ¸ ( ì¼ë°˜ì ìœ¼ë¡œ ì„œë²„ ì‹¤í–‰ ëª…ë ¹ )
â”‚       â””â”€â”€ test.sh         # ì½”ë“œ í¬ë§¤íŒ… ë° í…ŒìŠ¤íŠ¸ì½”ë“œ ì‹¤í–‰ ì‹œ ì‚¬ìš©ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ manage.py               # ê´€ë¦¬ ëª…ë ¹ì–´
â”œâ”€â”€ poetry.lock             # poetry ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì •ë³´
â””â”€â”€ pyproject.toml          # poetry ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ëª©ë¡ ë° ì„¤ì •


poetry ì´ˆê¸°í™”
poetry init

poetryë¡œ ìƒì„±ëœ ê°€ìƒí™˜ê²½ ê²½ë¡œ í™•ì¸
poetry env info --path
ê²½ë¡œ í™•ì¸ í›„ ì¸í„°í”„ë¦¬í„° ì„¤ì •

ê°€ìƒí™˜ê²½ í„°ë¯¸ë„ì— í™œì„±í™” (ì•ˆí•´ë„ë¨)
poetry env activate
ë°˜í™˜ ë˜ëŠ” ê°’ ë³µì‚¬í•´ì„œ ë‹¤ì‹œ ì‹¤í–‰

ì „ì²´ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (ê°œë°œìš© í¬í•¨)
poetry install

ë°°í¬ìš© íŒ¨í‚¤ì§€ë§Œ ì„¤ì¹˜ (dev ì œì™¸)
poetry install --no-dev
ì•ˆë ì‹œ
poetry install --no-root

ë¼ì´ë¸ŒëŸ¬ë¦¬ ì œê±°
poetry remove ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ë¦„

[tool.poetry.dependencies] ì—ëŠ” ë°°í¬ í™˜ê²½ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜
poetry add ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ë¦„

[tool.poetry.group.dev.dependencies] ì— ê°œë°œí™˜ê²½ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
poetry add -G dev ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ë¦„
ë˜ëŠ”
poetry add --group=dev ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ë¦„


docker-composeë¥¼ ì‚¬ìš©í•´ PostgreSQL DBìƒì„±

postgres ì…‹íŒ…
docker-compose-local.yml ìƒì„±

PostgreSQL ì´ë¯¸ì§€ ìƒì„± ë° ì‹¤í–‰
docker-compose -f resources/docker/docker-compose-local.yml up -d
docker-compose -f resources/docker/docker-compose-prod.yml up -d

ì‹¤í–‰ ì¤‘ì¸ ë„ì»¤ ì´ë¯¸ì§€ í™•ì¸ (ì´ë¯¸ì§€ id í™•ì¸ ê°€ëŠ¥)
docker ps

í™˜ê²½ ë³€ìˆ˜ ì±„í¬
docker exec wistar_db printenv | grep POSTGRES

ë„ì»¤ ì»¨í…Œì´ë„ˆ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì†
docker exec -it wistar_db psql -U postgres -d oz_project

ë„ì»¤ ì´ë¯¸ì§€ ì¤‘ì§€
docker stop ì´ë¯¸ì§€id

íŒ€ì›ì´ í•´ì•¼í•  ì¼

ê¹ƒ í´ë¡ 
git clone https://github.com/09-MainProject/MyFavIdolBack.git

pyenvë¡œ íŒŒì´ì¬ 3.13.1ë²„ì „ ì„¤ì¹˜
pyenv install 3.13.1

poetryê°€ ìƒì„±í•œ pyproject.tomlì— ì‘ì„±ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª©ë¡ì„ ê¸°ë°˜ìœ¼ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ ë° ì´ˆê¸°í™”
ì „ì²´ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (ê°œë°œìš© í¬í•¨)
poetry install
ì•ˆë ì‹œ
poetry install --no-root

git config ìë™ ì„¤ì •
ì‹¤í–‰ ê¶Œí•  ì„¤ì •
chmod +x resources/scripts/setup.sh
setup.sh ì‹¤í–‰
resources/scripts/setup.sh

cií…ŒìŠ¤íŠ¸ ì‹¤í–‰
chmod +x ./resources/scripts/test.sh
./resources/scripts/test.sh

ê°€ìƒí™˜ê²½ ì—†ìœ¼ë©´ ê°€ìƒí™˜ê²½ì„ ìë™ìƒì„±í•¨. ê¸°ë³¸ì„¤ì • : ì „ì—­ìœ„ì¹˜ì— ê°€ìƒí™”ê²½ ìƒì„±
í˜¹ì€ ê°€ìƒí™˜ê²½ì„ ë¯¸ë¦¬ ë§Œë“  ìƒíƒœì—ì„  ê°€ìƒí™˜ê²½ì— ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜

ì „ì—­ ê°€ìƒí™˜ê²½ ìœ„ì¹˜ í™•ì¸
poetry env info --path

ì „ì—­ ê°€ìƒí™˜ê²½ ì œê±°
poetry env remove python

ê°€ìƒí™˜ê²½ ìƒì„±
python3 -m venv .venv

ì„¤ì • íŒŒì¼ ìƒì„±
django-admin startproject config .

ì•± ë§Œë“¤ê¸°
python3 manage.py startapp ì•±ì´ë¦„

í•˜ìœ„ í´ë”ì— ì•± ë§Œë“¤ê¸° (ë§Œë“¤ì–´ì§ˆ ì•±ì´ë¦„ì˜ í´ë”ê°€ ê²½ë¡œì— ìˆì–´ì•¼í•¨)
python3 manage.py startapp ì•±ì´ë¦„ ê²½ë¡œ

postgresql db ì„¤ì¹˜
brew install postgresql

PostgreSQL ì„œë²„ ì‹¤í–‰
brew services start postgresql

ì‹¤í–‰ í™•ì¸
brew services

PostgreSQL ì„¤ì¹˜ì‹œ ìë™ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì¸ postgresì— ì ‘ì†
psql postgres

ìœ ì € í™•ì¸
ë³¸ì¸ì˜ ë§¥ ìœ ì € ì´ë¦„ í˜¹ì€ postgresë¼ëŠ” ìœ ì €ê°€ ìˆì–´ì•¼ ì •ìƒ
\du

ìƒˆë¡œìš´ ìœ ì €ë¥¼ ìƒì„±
CREATE USER ìœ ì €ì´ë¦„

ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
ALTER USER root WITH PASSWORD 'ë¹„ë°€ë²ˆí˜¸';

ê¶Œí•œ ì„¤ì •
ALTER USER root WITH SUPERUSER;

ìœ ì € ë‹¤ì‹œ í™•ì¸
\du

db ìƒì„±
CREATE DATABASE ë°ì´í„°ë² ì´ìŠ¤ì´ë¦„;

db ëª©ë¡ í™•ì¸
\l


ìƒˆë¡œ ìƒì„±ëœ ìœ ì € í˜¹ì€ ê¸°ë³¸ ìœ ì €ë¥¼ í™œìš©í•˜ì—¬ ìƒì„±ëœ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì ‘ì†
psql ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„
ë˜ëŠ”
psql -U ìœ ì €ì´ë¦„ -d ë°ì´í„°ë² ì´ìŠ¤ì´ë¦„ -W
(Wì˜µì…˜ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì—¬ ì ‘ì†í•˜ëŠ” ê²ƒ ì…ë‹ˆë‹¤. í•„ìˆ˜ëŠ” ì•„ë‹˜)

í…Œì´ë¸” ë‚´ì—­ì„ ì¡°íšŒ
\dt

PostgreSQLì„ Djangoì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ í•„ìš”í•œ psycopg ì„¤ì¹˜
poetry add psycopg2-binary


- í”„ë¡œì íŠ¸ì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¡œ ê´€ë¦¬í•´ì•¼í•˜ëŠ” ê²ƒ
    - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´
    - AWS ë˜ëŠ” NCP ë“±ì˜ í´ë¼ìš°ë“œ ì—°ê²° ì •ë³´
    - ì†Œì…œ ë¡œê·¸ì¸ Client ID, Client Secret, Redirect URI
    - ì™¸ë¶€ API ì¸ì¦ ì •ë³´
    - í”„ë¡œì íŠ¸ ì‹œí¬ë¦¿ í‚¤ ( ë§¤ìš° ì¤‘ìš” ! )


- CI / CD ì„¤ì •

ruff + pre-commit ì¶”ì²œ

--------
# Black
--------

blackì´ë€?
"The uncompromising Python code formatter"
(íƒ€í˜‘ ì—†ëŠ”, ì—„ê²©í•œ Python ì½”ë“œ í¬ë§¤í„°)

ğŸ”§ ë¬´ìŠ¨ ì—­í• ì„ í•˜ë‚˜ìš”?
Python ì½”ë“œë¥¼ ìë™ìœ¼ë¡œ ì •í•´ì§„ ìŠ¤íƒ€ì¼ëŒ€ë¡œ ì •ë¦¬í•´ì¤ë‹ˆë‹¤.

ê°œë°œìê°€ ì½”ë“œ ìŠ¤íƒ€ì¼ë¡œ ê³ ë¯¼í•˜ì§€ ì•Šë„ë¡ ê°•ë ¥í•œ ê·œì¹™ì„ ì ìš©í•©ë‹ˆë‹¤.

ì‚¬ëŒë§ˆë‹¤ ìŠ¤íƒ€ì¼ì´ ë‹¤ë¥¸ ê±¸ ë°©ì§€ â†’ íŒ€ í”„ë¡œì íŠ¸ì— íŠ¹íˆ ìœ ë¦¬

ë¸”ë™(black) ì„¤ì¹˜
poetry add --group=dev black

ë¸”ë™ ì‹¤í–‰
black .  ë˜ëŠ”  poetry run black .

Black	# fmt: off/on	í¬ë§¤íŒ… ì˜ˆì™¸ ì²˜ë¦¬ êµ¬ê°„ ì„¤ì •

----------
isort
----------

isortë€?
import ì •ë¦¬ ë„êµ¬: íŒŒì´ì¬ íŒŒì¼ ë‚´ì˜ import êµ¬ë¬¸ì„ ì•ŒíŒŒë²³ ìˆœì„œë¡œ ì •ë ¬í•˜ê³ , í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬, ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬, ë¡œì»¬ ëª¨ë“ˆì„ êµ¬ë¶„í•´ì„œ ê¹”ë”í•˜ê²Œ ì •ë ¬í•´ì¤ë‹ˆë‹¤.
í˜‘ì—… ì‹œ ì½”ë“œ ìŠ¤íƒ€ì¼ì„ í†µì¼í•˜ê³  ê°€ë…ì„±ì„ ë†’ì—¬ì¤ë‹ˆë‹¤.
Black, Flake8, Ruff ë“± ë‹¤ë¥¸ í¬ë§·í„°ë‚˜ ë¦°í„°ì™€ í•¨ê»˜ ìì£¼ ì‚¬ìš©ë©ë‹ˆë‹¤.

isort your_file.py   ë‹¨ì¼ íŒŒì¼ ì •ë ¬
isort .  í”„ë¡œì íŠ¸ ì „ì²´ ì •ë ¬
isort . --check   ê²€ì‚¬ë§Œ í•˜ê³  ìˆ˜ì •í•˜ì§€ ì•Šê¸° (CI ìš©ë„)

isort	# isort: skip	í•´ë‹¹ ì¤„ import ì •ë ¬ ì œì™¸
isort	# isort: off/on	êµ¬ê°„ ë‹¨ìœ„ import ì •ë ¬ ì œì™¸

----------
# Mypy
----------

mypyë€?
ì •ì  íƒ€ì… ê²€ì‚¬(static type checking)**ë¥¼ í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ë„êµ¬
mypyëŠ” Python ì½”ë“œì— ì‘ì„±ëœ **íƒ€ì… íŒíŠ¸(type hint)**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, ì½”ë“œ ì‹¤í–‰ ì—†ì´ íƒ€ì… ì˜¤ë¥˜ë¥¼ ì‚¬ì „ì— ì°¾ì•„ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.
Pythonì€ ê¸°ë³¸ì ìœ¼ë¡œ ë™ì  íƒ€ì… ì–¸ì–´ì´ì§€ë§Œ, íƒ€ì… íŒíŠ¸ë¥¼ í™œìš©í•˜ë©´ ì •ì  íƒ€ì…ì²˜ëŸ¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
íƒ€ì… ê´€ë ¨ ë²„ê·¸ë¥¼ ì¤„ì´ê³ , ì½”ë“œì˜ ì•ˆì •ì„±ê³¼ ê°€ë…ì„±ì„ ë†’ì´ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.


Mypy ì„¤ì¹˜
poetry add --group=dev mypy

mypyë¡œ ê²€ì‚¬
mypy .


# type: ignore	í•´ë‹¹ ë¼ì¸ ëª¨ë“  íƒ€ì… ì—ëŸ¬ ë¬´ì‹œ
# type: ignore[ì—ëŸ¬ì½”ë“œ]	íŠ¹ì • íƒ€ì… ì—ëŸ¬ë§Œ ë¬´ì‹œ
# mypy: ignore-errors	íŒŒì¼ ì „ì²´ íƒ€ì… ê²€ì‚¬ ë¬´ì‹œ
# mypy: disable-error-code	íŒŒì¼ ë‹¨ìœ„ íŠ¹ì • ì—ëŸ¬ì½”ë“œ ë¬´ì‹œ
# type:	ë³€ìˆ˜ì— íƒ€ì… ì£¼ì„ ì§€ì •

-----------
# Pytest
-----------

- pytestëŠ” íŒŒì´ì¬ì—ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‰½ê²Œ ì‘ì„±í•˜ê³  ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬

pytest ì„¤ì¹˜
poetry add --group=dev pytest

# pytest ì‚¬ìš©ì‹œ
# í•¨ìˆ˜ ì´ë¦„ ì•ì— test_ë¼ê³  ì¨ì£¼ë©´ test í•¨ìˆ˜ì¸ê±¸ ì¸ì‹í•œë‹¤.

# íŒŒì´ì°¸ì—ì„œ pytest í•¨ìˆ˜ë¥¼ ë§Œë“¤ë©´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ë²„íŠ¼ì´ ìƒê¸´ë‹¤.
# í„°ë¯¸ë„ì—ì„œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ pytest . ì´ë ‡ê²Œ ì…ë ¥í•˜ë©´ ë¨.
def test_simple() -> None:
    print("Testing simple")



poetry add --group=dev isort
ê²€ì‚¬
isort .

# isortê°€ í•´ë‹¹ import ì •ë ¬í•˜ì§€ ì•ŠìŒ
# isort: skip

í•´ë‹¹ ì—ëŸ¬ì½”ë“œ ë¬´ì‹œ ì„¤ì •
# noqa: ì—ëŸ¬ì½”ë“œ
# noqa: F405
# noqa: F403


í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
./resources/scripts/test.sh  ìƒì„±

ê¶Œí•œ ì„¤ì •
chmod +x ./resources/scripts/test.sh

ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
./resources/scripts/test.sh


# ymlì€ íƒ­ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
# yml ê²€ì‚¬ ì‚¬ì´íŠ¸
# https://www.yamllint.com/


ê¹ƒ í”Œë¡œìš°
https://legend-palm-1f1.notion.site/Git-Flow-14acaf5650aa800387a7c43e334cc72e
https://legend-palm-1f1.notion.site/Git-Flow-14acaf5650aa80f2a4a9efa455e54f9b

ë§¥ì—ì„œ í™ˆë¸Œë£¨ë¡œ ê¹ƒ í”Œë¡œìš° ì„¤ì¹˜
brew install git-flow-avh

ê¹ƒ í”Œë¡œìš° ì´ˆê¸°í™”
git flow init

Branch name for production releases?
â†’ ê¸°ë³¸ê°’ì€ master ì´ì§€ë§Œ main ìœ¼ë¡œ í•˜ëŠ”ê²ƒ ì¶”ì²œ

Branch name for "next release" development?
â†’ develop (ê¸°ë³¸ê°’)

ë‚˜ë¨¸ì§€ ì—”í„°

git push origin develop

ì´í›„ íŒ€ì› ì„¤ì •
git fetch origin   ë˜ëŠ”  git fetch --all

ì›ê²© develop ë¸Œëœì¹˜ ê¸°ì¤€ìœ¼ë¡œ ë¡œì»¬ develop ë¸Œëœì¹˜ ìƒì„±
git checkout -b develop origin/develop

# Feature ë¸Œëœì¹˜

ìƒì„±: ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ê°œë°œí•  ë•Œ ì‚¬ìš©
git flow feature start <ê¸°ëŠ¥ì´ë¦„>

ì™„ë£Œ: ê¸°ëŠ¥ ê°œë°œì„ ë§ˆì¹˜ê³  develop ë¸Œëœì¹˜ë¡œ ë³‘í•©
git flow feature finish <ê¸°ëŠ¥ì´ë¦„>

# Release ë¸Œëœì¹˜

ìƒì„±: ë°°í¬ ì¤€ë¹„ë¥¼ í•  ë•Œ ì‚¬ìš©
git flow release start <ë²„ì „ë²ˆí˜¸>

ì™„ë£Œ: ë¦´ë¦¬ì¦ˆ ì™„ë£Œ í›„ masterì™€ developì— ë³‘í•©
git flow release finish <ë²„ì „ë²ˆí˜¸>

# Hotfix ë¸Œëœì¹˜

ìƒì„±: ê¸´ê¸‰í•œ ë²„ê·¸ ìˆ˜ì •ì´ í•„ìš”í•  ë•Œ ì‚¬ìš©
git flow hotfix start <ë²„ê·¸ì´ë¦„>

ì™„ë£Œ: ìˆ˜ì • ì™„ë£Œ í›„ masterì™€ developì— ë³‘í•©
git flow hotfix finish <ë²„ê·¸ì´ë¦„>


## . Git Flow ì „ì²´ íë¦„

1. íŒ€ ë¦¬ë”ê°€ new project ìƒì„±í•˜ê³  ì´ˆê¸° ì„¸íŒ…ì„ ì§„í–‰
2. íŒ€ ë¦¬ë”ê°€ github repositoryì— ì˜¬ë¦¬ê¸°
3. ë‚˜ë¨¸ì§€ íŒ€ì›ë“¤ì€ repositoryì— ì˜¬ë¼ ì˜¨ projectë¥¼ í´ë¡ ë°›ì•„ ë¡œì»¬ì— ê°€ì ¸ì˜´
4. ì „ íŒ€ì› `git flow init` (ì´ˆê¸°í™”) í•´ì¤Œ
    - ì´ˆê¸°í™” ì‹œ `Branch name for production releases?`ì§ˆë¬¸ì—
    â†’ ê¸°ë³¸ ê°’ì€ `master` ì´ì§€ë§Œ `main` ìœ¼ë¡œ ì„¤ì •í•˜ì‹œëŠ” ê²ƒì„ ì¶”ì²œ..
5. ëª¨ë“  íŒ€ì› ë¡œì»¬ í™˜ê²½ì—ì„œ `git branch` ëª…ë ¹ì–´ë¡œ ì¡´ì¬í•˜ëŠ” ë¸Œëœì¹˜ë¥¼ í™•ì¸í•´ë³´ë©´ ì²˜ìŒì—ëŠ” `main` ë¸Œëœì¹˜ ë¿ë§Œ ìˆì—ˆì§€ë§Œ ì´ˆê¸°í™” ì´í›„  `develop` ë¸Œëœì¹˜ê°€ ë¡œì»¬ì— ìƒê²¨ìˆìŒì„ í™•ì¸ê°€ëŠ¥.
6. ê°ì ë§¡ì€ ê¸°ëŠ¥ ê°œë°œì„ ìœ„í•´ `git flow feature start ê¸°ëŠ¥ì´ë¦„` ëª…ë ¹ì–´ë¡œ feature ë¸Œëœì¹˜ë¥¼ ìƒì„±
â†’ `git branch` ëª…ë ¹ì–´ë¡œ í™•ì¸í•´ë³´ë©´ `feature/ê¸°ëŠ¥ì´ë¦„` ë¸Œëœì¹˜ê°€ ìƒì„±ë˜ì–´ìˆìŒ.
7. ìƒì„±ëœ feature ë¸Œëœì¹˜ì—ì„œ ê¸°ëŠ¥ ê°œë°œ ì‘ì—…í•©ë‹ˆë‹¤.
8. ì‘ì—… ì™„ë£Œ í›„ feature ë¸Œëœì¹˜ë¥¼ ì›ê²© ì €ì¥ì†Œì— push í•´ì„œ PR ì˜¬ë¦½ë‹ˆë‹¤.
9. PR íƒ€ì´í‹€, ì„¤ëª… ë“± ì‘ì„± í›„ ë¦¬ë·°ì–´ íŒ€ì›ë“¤ ë“±ë¡í•©ë‹ˆë‹¤.
10. PR ìŠ¹ì¸ ë˜ë©´ Squash and Merge ë²„íŠ¼ì„ í†µí•´ ì••ì¶• ëœ í•˜ë‚˜ì˜ ì»¤ë°‹ìœ¼ë¡œ developì— ë¨¸ì§€í•©ë‹ˆë‹¤.
11. ê·¸ë¦¬ê³  ë¡œì»¬ í™˜ê²½ì—ì„œ `develop` ë¸Œëœì¹˜ë¡œ checkout í•˜ê³ , ê¸°ëŠ¥ ê°œë°œì‹œì— ì‚¬ìš©í–ˆë˜ ê¸°ì¡´ì˜  feature ë¸Œëœì¹˜ëŠ” ì‚­ì œí•´ì¤ë‹ˆë‹¤.
12. ê°œë°œëœ ê¸°ëŠ¥ì´ ì—…ë°ì´íŠ¸ ëœ ì›ê²© ì €ì¥ì†Œì˜ `develop` ë¸Œëœì¹˜ë¥¼ `pull` í•©ë‹ˆë‹¤.
    - `git pull origin develop` ëª…ë ¹ì–´ ì‚¬ìš©í•˜ê¸°
13. (( 7~13ë²ˆ ë¬´í•œ ë°˜ë³µ ))
14. ê° íŒ€ì›ë“¤ì´ ê¸°ëŠ¥ ê°œë°œì„ ëª¨ë‘ ì™„ë£Œí–ˆë‹¤ë©´ ë°°í¬í•  ì¤€ë¹„ë¥¼ í•´ì•¼í•©ë‹ˆë‹¤. íŒ€ì¥ì´ ë°°í¬ ê´€ë ¨ ì„¤ì •ì„ ëª¨ë‘ ì™„ë£Œí•˜ê³  `develop` ë¸Œëœì¹˜ì— ë¨¸ì§€í•©ë‹ˆë‹¤.
15. `main` ë¸Œëœì¹˜ì™€ `develop` ë¸Œëœì¹˜ë¥¼ compare & PR í•œ í›„ `merge` í•©ë‹ˆë‹¤.
16. `main` ë¸Œëœì¹˜ë¥¼ EC2 ì—ì„œ í´ë¡ ë°›ì•„ ë°°í¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.


.gitignore ì‹œí¬ë¦¿ í´ë” ì—…ë¡œë“œ ì œí•œ
.config_secret/

ì‹œí¬ë¦¿ í´ë” ìƒì„±
.config_secret

ì‹œí¬ë¦¿ í´ë”ì— secret.json ìƒì„±

secret.jsonì— ì…ë ¥
{
  "DJANGO_SECRET_KEY" : "django-insecure-9u=$gmlz$b8h2^d9%3x871ti9pcile_q19lif*#yw(q@#=nb!8",
  "email": {
    "user": "ì´ë©”ì¼",
    "password": "ë¹„ë°€ë²ˆí˜¸"
  },
  "DB": {
  "ENGINE": "django.db.backends.postgresql",
  "NAME": "bank",
  "USER": "root",
  "PASSWORD": "1234",
  "HOST": "localhost",
  "PORT": "5432"
  }
}

ì‹œí¬ë¦¿ íŒŒì¼ ì½ì–´ ì˜¤ê¸° ìœ„í•´ settings.pyì— ì„¤ì •

with open(BASE_DIR / '.config_secret' / 'secret.json') as f:
    config_secret_str = f.read()

SECRET = json.loads(config_secret_str)  # json í˜•íƒœë¥¼ ë”•ì…”ë„ˆë¦¬ í˜•íƒœë¡œ ë°”ê¿ˆ

# Email
# from django.core.mail.backends.smtp import EmailBackend
EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
EMAIL_HOST = 'smtp.naver.com' # ë„¤ì´ë²„ í™˜ê²°ì„¤ì •ì—ì„œ ë³¼ ìˆ˜ ìˆìŒ.
EMAIL_USE_TLS = True  # ë³´ì•ˆì—°ê²°
EMAIL_PORT = 587  # ë„¤ì´ë²„ ë©”ì¼ í™˜ê²½ì„¤ì •ì—ì„œ í™•ì¸ ê°€ëŠ¥
EMAIL_HOST_USER = SECRET["email"]["user"]
EMAIL_HOST_PASSWORD =  SECRET["email"]["password"]

# .config_secret í´ë” ë§Œë“¤ê³ 
# í´ë”ì— secret.json ë§Œë“¤ê³ 
# .gitignoreì— ì¶”ê°€í•œ í›„ ê´€ë¦¬
# print(SECRET['DB']['HOST'])
# print(SECRET['DB2']['HOST'])
# ì´ë ‡ê²Œ ì“¸ ìˆ˜ë„ìˆê³  dotenvë¥¼ í†µí•´ ê´€ë¦¬í•  ìˆ˜ë„ ìˆìŒ

LOGIN_URL = '/login/'
LOGOUT_REDIRECT_URL = '/login/'
# LOGOUT_REDIRECT_URL = '/'



simplejwt ì‹œì‘
https://django-rest-framework-simplejwt.readthedocs.io/en/latest/getting_started.html

simplejwt ì„¤ì¹˜
poetry add djangorestframework-simplejwt

# config/settings.py

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        ...
        'rest_framework_simplejwt.authentication.JWTAuthentication',
        ...
    ]
}
INSTALLED_APPS = [
    ...
    'rest_framework_simplejwt',
    ...
]

# config/urls.py

urlpatterns = [
    ...
    path('api/token/', TokenObtainPairView.as_view(), name='token_obtain_pair'),
    path('api/token/refresh/', TokenRefreshView.as_view(), name='token_refresh'),
    path('api/token/verify/', TokenVerifyView.as_view(), name='token_verify'),
    ...
]

simplejwt ì„¸íŒ…
https://django-rest-framework-simplejwt.readthedocs.io/en/latest/settings.html#


simplejwt ì»¤ìŠ¤í„° ë§ˆì´ì§•
https://django-rest-framework-simplejwt.readthedocs.io/en/latest/customizing_token_claims.html

# utils/jwt_serializers.py

from rest_framework_simplejwt.serializers import TokenObtainPairSerializer
from rest_framework_simplejwt.views import TokenObtainPairView

class MyTokenObtainPairSerializer(TokenObtainPairSerializer):
    @classmethod
    def get_token(cls, user):
        token = super().get_token(user)

        # Add custom claims
        token['user_name'] = user.username  # í† í°ì— ìœ ì € ì´ë¦„ì„ í•¨ê»˜ ë‹´ì•„ì„œ ë³´ëƒ„

        return token

# config/settings.py
# JWT ì„¤ì •
SIMPLE_JWT = {
  # It will work instead of the default serializer(TokenObtainPairSerializer).
  "TOKEN_OBTAIN_SERIALIZER": "utils.jwt_serializers.MyTokenObtainPairSerializer",
  # ...
}

í† í° ì •ë³´ ë³´ëŠ” ë²•
https://jwt.io/

í† í° ë§Œë£Œì‹œê°„ ìˆ˜ì •
# JWT ì„¤ì •
SIMPLE_JWT = {
    "ACCESS_TOKEN_LIFETIME": timedelta(minutes=30),
    "REFRESH_TOKEN_LIFETIME": timedelta(days=1),
    # It will work instead of the default serializer(TokenObtainPairSerializer).
    "TOKEN_OBTAIN_SERIALIZER": "utils.jwt_serializers.MyTokenObtainPairSerializer",
    # ...
}

poetry add -G dev django-extensions
poetry add -G dev ipython

poetry.lock ì—…ë°ì´íŠ¸
poetry lock


ê°œë°œí™˜ê²½ìœ¼ë¡œ ê°€ìƒí™˜ê²½ì— ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
poetry install --with dev --no-root

ë¡œê·¸ì•„ì›ƒ êµ¬í˜„
INSTALLED_APPS = [
    ...
    'rest_framework_simplejwt.token_blacklist',
]

# JWT ì„¤ì •
SIMPLE_JWT = {
    "BLACKLIST_AFTER_ROTATION": True,
    "ROTATE_REFRESH_TOKENS": True,
}

python manage.py migrate

ì—‘ì„¸ìŠ¤ í† í° (Access Token) ê´€ë¦¬

# 1.ì—‘ì„¸ìŠ¤ í† í° localStorageì— ì €ì¥ ë° ì‚­ì œ
// ë¡œê·¸ì¸ ì‹œ ì €ì¥
localStorage.setItem('access_token', accessToken);
// ë¡œê·¸ì•„ì›ƒ ì‹œ ì‚­ì œ
localStorage.removeItem('access_token');

sessionStorage ì‚¬ìš© ì‹œ
sessionStorage.removeItem('access_token');

React ìƒíƒœ ê´€ë¦¬ (Redux ë“±)	ìƒíƒœ ì´ˆê¸°í™”
dispatch({ type: 'LOGOUT' });  // í† í° ìƒíƒœ null ì²˜ë¦¬

ì„œë²„ì—ì„œ ì œì–´ (í”„ë¡ íŠ¸ì—ì„œ í† í°ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ)
HttpOnly Cookie	JSì—ì„œ ì‚­ì œ ë¶ˆê°€ â†’ ì„œë²„ì—ì„œ ì¿ í‚¤ ë§Œë£Œ ì²˜ë¦¬



----------------------
HttpOnly ì¿ í‚¤ì˜ í•µì‹¬ íŠ¹ì§•
----------------------

íŠ¹ì§•	ì„¤ëª…
JS ì ‘ê·¼ ë¶ˆê°€	document.cookieë¡œ ì½ê¸°/ì“°ê¸° ë¶ˆê°€
ìë™ ì „ì†¡	ê°™ì€ ë„ë©”ì¸ ìš”ì²­ ì‹œ ìë™ìœ¼ë¡œ í¬í•¨
ë³´ì•ˆ ê°•í™”	XSS ê³µê²©ìœ¼ë¡œë¶€í„° ì•ˆì „
ì‚­ì œ ë°©ë²•	ì˜¤ì§ ì„œë²„ê°€ ì¿ í‚¤ ë§Œë£Œ ì²˜ë¦¬ (Set-Cookieë¡œ)

final_response = Response(custom_response, status=status.HTTP_200_OK)
final_response.set_cookie(
    key='refresh_token',
    value=refresh_token,
    httponly=True,
    # secure=True,        # HTTPS í™˜ê²½ì—ì„œë§Œ ì „ì†¡
    secure=False,        # ë¡œì»¬ ê°œë°œ í™˜ê²½ì— ë§ì¶°ì„œ ì„¤ì •
    samesite='Lax',     # CSRF ê³µê²© ë°©ì§€ ì„¤ì •
    path='/api/token',  # í•„ìš”í•œ ê²½ë¡œì—ë§Œ ì¿ í‚¤ ì‚¬ìš©
    max_age=60 * 60 * 24 * 7,  # 7ì¼ (ì´ˆ ë‹¨ìœ„)
)
return final_response

settings.py ì„¤ì •
INSTALLED_APPS += ['corsheaders']

MIDDLEWARE = [
    'corsheaders.middleware.CorsMiddleware',   # ìµœìƒë‹¨ì— ì¶”ê°€
    # ... ê¸°íƒ€ ë¯¸ë“¤ì›¨ì–´
]

# í”„ë¡ íŠ¸ ë„ë©”ì¸ ë“±ë¡
CORS_ALLOWED_ORIGINS = [
    "http://localhost:5173",
]

# ì¿ í‚¤ í¬í•¨ í—ˆìš©
CORS_ALLOW_CREDENTIALS = True
CORS_ALLOW_METHODS = ['GET','POST','PUT','PATCH','DELETE','OPTIONS']

--------------------
ì´ë©”ì¼ ë³´ë‚´ëŠ” ê¸°ëŠ¥ ë¬¸ì œ
--------------------

DEBUG=Falseì¼ ë•Œ ì´ë©”ì¼ ë³´ë‚´ëŠ” ê¸°ëŠ¥ì— ë¬¸ì œìƒê¸´ë‹¤ë©´.

from django.core.mail import send_mail
send_mail í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ë•Œ ë¬¸ì œê°€ ìƒê¸´ë‹¤ë©´

try:
    send_mail(subject, message, settings.EMAIL_HOST_USER, to_email)
except Exception as e:
    print(repr(e))
    raise

ì´ë ‡ê²Œ í•´ì„œ ì‹¤íŒ¨ í–ˆì„ ë•Œ ì›ì¸ì„ ì˜¤ë¥˜ ì½”ë“œë¡œ íŒŒì•…í•œë‹¤.

ì›ì¸ì€
SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: self-signed certificate in certificate chain (_ssl.c:1018)')
ì¸ì¦ì„œë¥¼ ì°¾ì§€ ëª»í•´ì„œ ì˜¤ë¥˜ê°€ ë‚¬ë‹¤ëŠ” ë§ì¸ë°

íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ certifi ì„¤ì¹˜ í›„
ì¸ì¦ì„œë¥¼ ê°•ì œë¡œ ì¸ì‹ ê°€ëŠ¥í•˜ê²Œ certifië¡œ ì„¤ì •í•˜ë©´ ì–´ë– í•œ ê²½ìš°ì—ë„ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.
ì¸ì¦ì„œ ê²½ë¡œë¥¼ ì¸ì‹ëª»í•˜ë“  ì¸ì¦ì„œê°€ ì‹¤ì œë¡œ ì¡´ì¬í•˜ì§€ ì•Šë“  ì¸ì‹.

í„°ë¯¸ë„ì— ì…ë ¥í•´ì„œ ì¼ì‹œì ìœ¼ë¡œ í•´ê²°í•˜ëŠ” ë°©ë²•
export SSL_CERT_FILE=$(python -m certifi)

í•´ê²°ë°©ë²•1
í„°ë¯¸ë„ì— ì˜êµ¬ ì ìš©

vim ~/.zshrc
ë§¨ ì•„ë« ì¤„ì— ì¶”ê°€
export SSL_CERT_FILE=$(python -m certifi)

í•´ê²°ë°©ë²•2
ê°€ìƒí™˜ê²½ì´ í™œì„±í™” ë ë•Œë§ˆë‹¤ ì¸ì¦ì„œ ê²½ë¡œë¥¼ ìë™ ì§€ì •í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•œë‹¤.

activateìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •
vim .venv/bin/activate
ë§¨ ì•„ë«ì¤„ì— ì¶”ê°€
export SSL_CERT_FILE=$(python -m certifi)

í•´ê²°ë°©ë²•3 (ê°€ì¥ ì¶”ì²œ)
í”„ë¡œì íŠ¸ê°€ ì¸ì¦ì„œ ê²½ë¡œë¥¼ ì¸ì‹í•  ìˆ˜ ìˆë„ë¡ ì¥ê³  í”„ë¡œì íŠ¸ì— ì„¤ì •

certifië¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ìœ¼ë©´ ì„¤ì¹˜ í›„

settings.py ìµœìƒë‹¨ì— ì„¤ì •

import os
import certifi
os.environ['SSL_CERT_FILE'] = certifi.where()


-------------------
# ì†Œì…œ ë¡œê·¸ì¸ ê¸°ëŠ¥ ì¶”ê°€
-------------------

1. ì‚¬ìš©ìê°€ í”„ë¡ íŠ¸ì—ì„œ 'ì†Œì…œ ë¡œê·¸ì¸' ë²„íŠ¼ í´ë¦­
     â†“
2. í”„ë¡ íŠ¸ê°€ ë°±ì—”ë“œì˜ /oauth/naver/login ê°™ì€ ì—”ë“œí¬ì¸íŠ¸ë¡œ ì´ë™ (RedirectView)
     â†“
3. ë°±ì—”ë“œê°€ Naver ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
     â†“
4. ì‚¬ìš©ìê°€ Naverì—ì„œ ë¡œê·¸ì¸í•˜ê³  ì½œë°± URLë¡œ ì´ë™
     â†“
5. ë°±ì—”ë“œê°€ access_token ë°›ê³  ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
     â†“
6. ë°±ì—”ë“œì—ì„œ íšŒì› ìƒì„± ë˜ëŠ” ë¡œê·¸ì¸ ì²˜ë¦¬
     â†“
7. **JWT í† í°ì„ ë°œê¸‰í•´ì„œ í”„ë¡ íŠ¸ë¡œ ì „ë‹¬ (ex. ì¿¼ë¦¬íŒŒë¼ë¯¸í„° or URL Fragment)**
     â†“
8. í”„ë¡ íŠ¸ëŠ” ì „ë‹¬ë°›ì€ í† í°ì„ ì €ì¥(localStorage ë“±)í•˜ê³  ë¡œê·¸ì¸ ì™„ë£Œ ì²˜ë¦¬



-----------
  ë°°í¬í•˜ê¸°
-----------
https://www.notion.so/7-1c2caf5650aa806ba040f5af5cf08ce4

EC2, S3, IAM ìƒì„±

.env ì‘ì„±í•˜ê¸°
ê°’ì´ë‘ ì£¼ì„ì´ë‘ ê°™ì€ ì¤„ì— ìˆìœ¼ë©´ ì£¼ì„ë„ ê°™ì´ ê°’ìœ¼ë¡œ ì¸ì‹
ê³µë°±ë„ ìˆìœ¼ë©´ ì•ˆë¨
# IAM í‚¤ (ë‹¤ìš´ë°›ì€ csv íŒŒì¼ì—ì„œ í™•ì¸)
S3_ACCESS_KEY=ìƒì„±í•œ ì•¡ì„¸ìŠ¤ í‚¤
S3_SECRET_ACCESS_KEY=ìƒì„±í•œ ë¹„ë°€ ì•¡ì„¸ìŠ¤ í‚¤

# S3 ë²„í‚· ì„¤ì •
S3_STORAGE_BUCKET_NAME=ë³¸ì¸ ë²„í‚· ì´ë¦„
S3_REGION_NAME=ap-northeast-2

django-storages, boto3 ì„¤ì¹˜
poetry add django-storages boto3

- `django-storages`: static, media ê°™ì€ íŒŒì¼ì„ ì €ì¥ì†Œì™€ ì—°ê²°í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
- `boto3`: AWS ì— pythonì„ ì´ìš©í•´ì„œ ì—‘ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬

# settings.pyì— ì¶”ê°€

# INSTALLED_APPSì— storages ì¶”ê°€
INSTALLED_APPS = [
  	...
    "storages",
]

# Static, Media URL ìˆ˜ì •
STATIC_URL = f'https://{os.getenv("S3_STORAGE_BUCKET_NAME", "django-mini-project")}.s3.amazonaws.com/static/'
MEDIA_URL = f'https://{os.getenv("S3_STORAGE_BUCKET_NAME", "django-mini-project")}.s3.amazonaws.com/media/'

# STORAGES ì‘ì„±
STORAGES = {
    "default": {
        "BACKEND": "storages.backends.s3.S3Storage",
        "OPTIONS": {
            "access_key": os.getenv("S3_ACCESS_KEY", ""),
            "secret_key": os.getenv("S3_SECRET_ACCESS_KEY", ""),
            "bucket_name": os.getenv("S3_STORAGE_BUCKET_NAME", ""),
            "region_name": os.getenv("S3_REGION_NAME", ""),
            "location": "media",
            "default_acl": "public-read",
        },
    },
    "staticfiles": {
        "BACKEND": "storages.backends.s3.S3Storage",
        "OPTIONS": {
            "access_key": os.getenv("S3_ACCESS_KEY", ""),
            "secret_key": os.getenv("S3_SECRET_ACCESS_KEY", ""),
            "bucket_name": os.getenv("S3_STORAGE_BUCKET_NAME", ""),
            "region_name": os.getenv("S3_REGION_NAME", ""),
            "custom_domain": f'{os.getenv("S3_STORAGE_BUCKET_NAME", "")}.s3.amazonaws.com',
            "location": "static",
            "default_acl": "public-read",
        },
    },
}

--------------------------
# S3ì— static íŒŒì¼ ì—…ë¡œë“œ í•˜ê¸°
--------------------------

python-dotenv ì„¤ì¹˜
poetry add python-dotenv

settings.pyì— ì„¤ì •
from dotenv import load_dotenv
load_dotenv(BASE_DIR / '.env')  # .env íŒŒì¼ ë¡œë“œ

# S3ì— static íŒŒì¼ ì—…ë¡œë“œ
python3 manage.py collectstatic

--------------
RDS ìƒì„± ë° ì„¤ì •
--------------

RDSìƒì„±

.envì— DATABASES ì •ë³´ ì…ë ¥

settings.py(prod.py)ì— ì„¤ì •
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': os.getenv("DB_NAME"),              # ìƒì„±í•œ DB ì´ë¦„
        'USER': os.getenv("DB_USER"),              # PostgreSQL ì‚¬ìš©ì
        'PASSWORD': os.getenv("DB_PASSWORD"),      # ë¹„ë°€ë²ˆí˜¸
        'HOST': os.getenv("DB_HOST"),              # ë¡œì»¬ì—ì„œ ì‹¤í–‰ ì¤‘ì´ë¯€ë¡œ localhost
        'PORT': os.getenv("DB_PORT", "5432"),      # RDS ì—”ë“œí¬ì¸íŠ¸
    }
}

ec2 ì ‘ì†
ssh -i í‚¤/í˜ì–´/ì €ì¥/ìœ„ì¹˜/mp-key.pem ubuntu@EC2_PUBLIC_IP

--------------------------
# Docker ì„¸íŒ…
--------------------------

ì‘ì„±í•œ Dockerfileì„ í†µí•´ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œ
# docker build -t django .
docker build -f resources/docker/Dockerfile -t wistarback .

ë¹Œë“œëœ Docker ì´ë¯¸ì§€ë¥¼ í†µí•´ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
# docker run -p 8000:8000 --env-file .env django
docker run -p 8000:8000 --env-file ./envs/local.env wistarback
docker run -p 8000:8000 --env-file ./envs/prod.env wistarback

Dockerfile ìƒì„±
# ë² ì´ìŠ¤ ì´ë¯¸ì§€ (ë³¸ì¸ í”„ë¡œì íŠ¸ì— ë§ëŠ” ë²„ì „ ê¸°ì…)
FROM python:3.12-slim

ENV PYTHONUNBUFFERED 1
ENV PYTHONDONTWRITEBYTECODE 1

# ì¢…ì†ì„± íŒŒì¼ ë³µì‚¬
COPY ./poetry.lock /mini_project/
COPY ./pyproject.toml /mini_project/

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /mini_project

# ì¢…ì†ì„± ì„¤ì¹˜
RUN pip3 install poetry
RUN poetry config virtualenvs.create false
RUN poetry install
RUN poetry add gunicorn

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ë³µì‚¬
COPY ./app /mini_project/app
WORKDIR /mini_project/app


# ì†Œì¼“ íŒŒì¼ ìƒì„± ë””ë ‰í† ë¦¬ ê¶Œí•œ ì„¤ì •
RUN mkdir -p /mini_project && chmod -R 755 /mini_project

# Gunicornì„ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
CMD ["gunicorn", "config.wsgi:application", "--bind", "0.0.0.0:8000", "--workers", "2"]

ì‰˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

scripts/run.sh ìƒì„±
mkdir -p scripts
touch scripts/run.sh

ë„ì»¤ ë¹Œë“œ
docker build -t django .

ë¹Œë“œëœ Docker ì´ë¯¸ì§€ë¥¼ í†µí•´ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker run -p 8000:8000 --env-file .env django

ì‹¤í–‰ì¤‘ì¸ ë„ì»¤ í™•ì¸
docker ps

ì»¨í…Œì´ë„ˆ ì¤‘ì§€
docker stop <ì»¨í…Œì´ë„ˆID ë˜ëŠ” ì´ë¦„>

ì»¨í…Œì´ì € ì‚­ì œ
docker rm <ì»¨í…Œì´ë„ˆID ë˜ëŠ” ì´ë¦„>

ë¹Œë“œëœ ì´ë¯¸ì§€ ëª©ë¡
docker images

ì´ë¯¸ì§€ë„ ì‚­ì œ (ì›í•  ê²½ìš°)
docker rmi [ì´ë¯¸ì§€ëª…]

rds dbì— ì ‘ì†
psql -h <ì—”ë“œí¬ì¸íŠ¸> -U <DB_USER> -d <DB_NAME> -p <PORT>

ê¹ƒ ë¦¬íŒŒì§“í† ë¦¬ íŠ¹ì • ë¸Œëœì¹˜ í´ë¡ 
git clone -b <ë¸Œëœì¹˜ëª…> <ì›ê²©ì£¼ì†Œ>



import hashlib
import hmac

from django.http import HttpResponseForbidden
from django.middleware.csrf import CsrfViewMiddleware

from config.settings import SECRET_KEY


class CustomCSRFMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response
        self.exempt_paths = [
            '/api'     # ì˜ˆ: í† í° ë°œê¸‰ ê²½ë¡œ ë“±
        ]
        self.csrf_protected_paths = [
            '/api/users/token/refresh',
            '/api/users/logout'
        ]

    def __call__(self, request):

        path = request.path

        # 1ï¸âƒ£ CSRF ê²€ì‚¬ ì˜ˆì™¸ ì²˜ë¦¬
        if any(path.startswith(exempt) for exempt in self.exempt_paths):
            # 2ï¸âƒ£ íŠ¹ì • ê²½ë¡œëŠ” ë‹¤ì‹œ CSRF ê²€ì‚¬ ìˆ˜í–‰
            if path in self.csrf_protected_paths:
                return CsrfViewMiddleware(self.get_response)(request)
            # ê·¸ ì™¸ APIëŠ” CSRF ë¬´ì‹œ
            return self.get_response(request)

        # ê¸°ë³¸ ì›¹ ìš”ì²­ì€ ê¸°ì¡´ CSRF ì²˜ë¦¬
        return CsrfViewMiddleware(self.get_response)(request)




    def __call__(self, request):

        # ì˜ˆì™¸ ê²½ë¡œëŠ” ê²€ì¦ ì œì™¸
        if request.path in self.exempt_paths:
            return self.get_response(request)

        if request.method in ['POST', 'PUT', 'DELETE']:  # ì¤‘ìš” ìš”ì²­ë§Œ ê²€ì¦
            token = request.headers.get('X-CSRFToken')
            if not self.is_valid(token):
                return HttpResponseForbidden("CSRF ê²€ì¦ ì‹¤íŒ¨")
        return self.get_response(request)


-----------------------------
Ubuntu ì„œë²„ì—ì„œ CI/CD ì‚¬ìš©í•´ ë°°í¬ ì„¤ì •í•˜ê¸°
-----------------------------
ssh -i ~/Downloads/wistar.pem ubuntu@43.203.181.6

mv ~/Downloads/wistar.pem ~/.ssh
# ë§Œì•½ ~/.ssh ê²½ë¡œê°€ì—†ë‹¤ë©´ .ssh í´ë”ë¥¼ ìƒì„±í•´ì¤˜ì•¼í•©ë‹ˆë‹¤.
mkdir ~/.ssh

# mv ëª…ë ¹ì–´ê°€ ë“£ì§€ ì•ŠëŠ” ê²½ìš° sudoë¥¼ í†µí•´ì„œ ì‹¤í–‰í•´ë³´ì„¸ìš”.

í™•ì¸
cd ~/.ssh
ls -l

chmod 400 wistar.pem   # ì½ê¸° ëª¨ë“œ ì„¤ì • ì¶”ì²œ 600ì€ ì½ê¸°/ì“°ê¸°
ls -l

ssh -i ~/.ssh/wistar.pem ubuntu@43.203.181.6

Pyenv ì„¤ì¹˜ ë° ì„¤ì •
sudo apt-get update --fix-missing
sudo apt-get install -y make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev xz-utils libpq-dev python3-dev python3-setuptools liblzma-dev

curl https://pyenv.run | bash

- ê° íŒ¨í‚¤ì§€ì˜ ì—­í• 
    - **`make`**: ì»´íŒŒì¼, ë§í¬ ë“±ì„ ìœ„í•œ ìë™í™” ë„êµ¬ì…ë‹ˆë‹¤.
    - **`build-essential`**: C/C++ ì»´íŒŒì¼ëŸ¬ ë° ê´€ë ¨ ë„êµ¬ë“¤(gcc, g++, make, libc6-dev ë“±)ì„ í¬í•¨í•œ ë©”íƒ€íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤. ì†ŒìŠ¤ ì½”ë“œë¡œë¶€í„° í”„ë¡œê·¸ë¨ì„ ë¹Œë“œí•  ë•Œ í•„ìš”í•©ë‹ˆë‹¤.
    - **`libssl-dev`**: OpenSSL ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê°œë°œ í—¤ë” íŒŒì¼ì„ í¬í•¨í•˜ë©°, ë³´ì•ˆ í†µì‹ ê³¼ ê´€ë ¨ëœ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
    - **`zlib1g-dev`**: ì••ì¶• ê´€ë ¨ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” zlib ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê°œë°œ í—¤ë” íŒŒì¼ì…ë‹ˆë‹¤.
    - **`libbz2-dev`**: Bzip2 ì••ì¶• ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê°œë°œ í—¤ë” íŒŒì¼ì…ë‹ˆë‹¤.
    - **`libreadline-dev`**: í„°ë¯¸ë„ì—ì„œì˜ í…ìŠ¤íŠ¸ ì…ë ¥ì„ í¸ë¦¬í•˜ê²Œ í•´ì£¼ëŠ” readline ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê°œë°œ í—¤ë” íŒŒì¼ì…ë‹ˆë‹¤.
    - **`libsqlite3-dev`**: SQLite ë°ì´í„°ë² ì´ìŠ¤ ì—”ì§„ì˜ ê°œë°œ í—¤ë” íŒŒì¼ì…ë‹ˆë‹¤.
    - **`wget`**: íŒŒì¼ ë‹¤ìš´ë¡œë“œë¥¼ ìœ„í•œ ì»¤ë§¨ë“œë¼ì¸ ë„êµ¬ì…ë‹ˆë‹¤.
    - **`curl`**: URLì„ í†µí•´ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê±°ë‚˜ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.
    - **`llvm`**: Low-Level Virtual Machineì˜ ì•½ìë¡œ, ì»´íŒŒì¼ëŸ¬ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. `pyenv`ë¡œ Pythonì„ ë¹Œë“œí•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
    - **`libncurses5-dev` ë° `libncursesw5-dev`**: í„°ë¯¸ë„ UI ê°œë°œì„ ìœ„í•œ ncurses ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê°œë°œ í—¤ë” íŒŒì¼ì…ë‹ˆë‹¤.
    - **`xz-utils`**: xz ì••ì¶• íŒŒì¼ì„ ë‹¤ë£¨ê¸° ìœ„í•œ ìœ í‹¸ë¦¬í‹°ì…ë‹ˆë‹¤.
    - **`libpq-dev`**: PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìœ„í•œ ê°œë°œ í—¤ë” íŒŒì¼ì…ë‹ˆë‹¤. Pythonì—ì„œ PostgreSQLì„ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ì— í•„ìš”í•©ë‹ˆë‹¤.
    - **`python3-dev`**: Python 3 í—¤ë” íŒŒì¼ê³¼ ê°œë°œ ë„êµ¬ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. Python C í™•ì¥ì„ ë¹Œë“œí•  ë•Œ í•„ìš”í•©ë‹ˆë‹¤.
    - `python3-setuptools`
        - **íŒ¨í‚¤ì§€ ì„¤ì¹˜**: Python íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ê³ , ì¢…ì†ì„±ì„ í•´ê²°í•©ë‹ˆë‹¤.
        - **íŒ¨í‚¤ì§€ ë°°í¬**: Python íŒ¨í‚¤ì§€ë¥¼ ìƒì„±í•˜ê³ , ë°°í¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.
        - **`pip`ì™€ í•¨ê»˜ ì‚¬ìš©**: `pip`ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•  ë•Œ, `setuptools`ê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ( ì—¬ê¸°ì„œëŠ” Pillow ì„¤ì¹˜ë¥¼ ìœ„í•¨)
    - **`liblzma-dev`**: LZMA ì••ì¶• ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê°œë°œ í—¤ë” íŒŒì¼ì…ë‹ˆë‹¤.

- `curl https://pyenv.run | bash` í•´ì„
    `https://pyenv.run` ìœ¼ë¡œë¶€í„° pyenv ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì„ ë‹¤ìš´ë°›ì•„ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤.
    ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” `pyenv`, `pyenv-virtualenv`, `pyenv-update` ë“±ì˜ ì„¤ì¹˜ë¥¼ ìë™ìœ¼ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.
    í•„ìš”í•œ ì´ˆê¸° ì„¤ì •ì„ .bashrcë‚˜ .zshrc íŒŒì¼ì— ì¶”ê°€í•˜ì—¬ `pyenv` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í™˜ê²½ì„ êµ¬ì„±í•©ë‹ˆë‹¤.


Ubuntu ì‚¬ìš©ì ê³„ì •ì˜ Bash ì…¸ ì„¤ì • íŒŒì¼ì„ í¸ì§‘
.bashrc ì— pyenv ì„¤ì • ì¶”ê°€í•˜ê¸°

# vi ì—ë””í„°ë¡œ .bashrc í¸ì§‘í•˜ê¸°
sudo vi ~/.bashrc

# í„°ë¯¸ë„ ì¬ì‹¤í–‰
source ~/.bashrc

yenvì—ì„œ ì‚¬ìš©í•  pythonì„ ì„¤ì¹˜í•´ì¤ë‹ˆë‹¤.
pyenv install <version>
pyenv install 3.13.1

Github SSH-Keygen
í„°ë¯¸ë„ì—ì„œ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥ í›„ ê³„ì† Enterë¥¼ ëˆŒëŸ¬ ssh-keyë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
ssh-keygen -t rsa -b 4096 -C "ê¹ƒí—ˆë¸Œ ì´ë©”ì¼"
ssh-keygen -t rsa -b 4096 -C "xowls0131@naver.com"

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ í˜„ì¬ ì‰˜ì—ì„œ SSH ì—ì´ì „íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
eval "$(ssh-agent -s)"

vi ì—ë””í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ .ssh / config íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.
vi ~/.ssh/config

ì•„ë˜ ë‚´ìš© ì¶”ê°€ í›„ ì €ì¥
Host github.com
  AddKeysToAgent yes
  IdentityFile ~/.ssh/id_rsa

ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ssh-agentì— ë°©ê¸ˆ ìƒì„±í•œ SSH-Keyë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
ssh-add -k ~/.ssh/id_rsa

ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ id_rsa.pub íŒŒì¼ì„ ì—´ì–´ ì´ë©”ì¼ ì•ìª½ì˜ í‚¤ê°’ë§Œ ë³µì‚¬í•©ë‹ˆë‹¤.
sudo vi ~/.ssh/id_rsa.pub

ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ì‘ì„±í•œ ì½”ë“œë¥¼ í´ë¡  ë°›ìŠµë‹ˆë‹¤.
git clone --branch develop --single-branch <ë ˆí¬ì§€í† ë¦¬ ì£¼ì†Œ>
git clone --branch prod/test2 --single-branch https://github.com/09-MainProject/WiStarBack.git

í”„ë¡œì íŠ¸ ê²½ë¡œë¡œ ì´ë™
cd <í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í„°ë¦¬>
cd WiStarBack

settings.py ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
ln -sf config/settings/prod.py config/settings/settings.py

envs í´ë”ë¥¼ ìƒì„±í•˜ê³  í•˜ìœ„ì— .env.prod íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.
mkdir envs
cd envs

# touch ëª…ë ¹ì–´ë¡œ ë¹ˆ íŒŒì¼ ìƒì„±
touch .env.prod

# .env.prodë¥¼  vi ì—ë””í„°ë¡œ í¸ì§‘í•©ë‹ˆë‹¤.
vi .env.prod

# pyenv ê°€ìƒí™˜ê²½ ìƒì„±
pyenv virtualenv <python-version> ê°€ìƒí™˜ê²½ì´ë¦„
pyenv virtualenv 3.13.1 wistar

# ê°€ìƒí™˜ê²½ ì ìš©
pyenv local ê°€ìƒí™˜ê²½ì´ë¦„
pyenv local wistar
pyenv local 3.13.1  #ê°€ìƒí™˜ê²½ ìƒì„± ì—†ì´ ë²„ì „ íŒŒì´ì¬ ë²„ì „ ì„¤ì •

# ê°€ìƒí™˜ê²½ ì ìš© í™•ì¸
python --version

# poetry ì„¤ì¹˜
curl -sSL https://install.python-poetry.org | python3 -

# .bashrc ìˆ˜ì •
vi ~/.bashrc

# ì•„ë˜ì˜ ë‚´ìš©ì„ .bashrcì— ì¶”ê°€í•´ì¤ë‹ˆë‹¤.
export PATH="/home/ubuntu/.local/bin:$PATH"

# í„°ë¯¸ë„ ì¬ì‹¤í–‰
source ~/.bashrc

# poetryë¥¼ í†µí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
poetry install
poetry install --no-root

ê°€ìƒí™˜ê²½ í„°ë¯¸ë„ì— í™œì„±í™” (poetryë¡œ ìƒì„±ëœ ê°€ìƒí™˜ê²½ ì‚¬ìš©ì‹œ)
poetry env activate


### Gunicorn ì„¤ì •í•˜ê¸°
ì•„ë˜ì˜ ê°€ì´ë“œë¥¼ ë”°ë¼ Gunicorn ì„¤ì •ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

# Gunicorn ê°€ìƒí™˜ê²½ ì„¤ì •
pyenv virtualenv <python version> gunicorn
pyenv virtualenv 3.13.1 gunicorn

# í˜„ì¬ ì‰˜ì— gunicorn ê°€ìƒí™˜ê²½ ì§€ì •
pyenv shell gunicorn

# ê°€ìƒí™˜ê²½ì— gunicorn ì„¤ì¹˜
pip install gunicorn

# ê°€ìƒí™˜ê²½ì— poetryë¥¼ ì´ìš©í•˜ì—¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ ì„¤ì¹˜
poetry install
poetry install --no-root

# Gunicorn ì‹œìŠ¤í…œ ì„¤ì •
sudo vi /etc/systemd/system/gunicorn.service

# ì•„ë˜ì˜ ë‚´ìš©ì„ ì¶”ê°€í›„ :wq
[Unit]
Description=gunicorn daemon
After=network.target

[Service]
User=ubuntu
Group=ubuntu
WorkingDirectory=/home/ubuntu/í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í„°ë¦¬
ExecStart=/home/ubuntu/.pyenv/versions/gunicorn/bin/gunicorn \
        --access-logfile /var/log/gunicorn/access.log \
        --error-logfile /var/log/gunicorn/error.log \
        --log-level info \
        --workers 3 \
        --bind unix:/srv/gunicorn/gunicorn.sock config.wsgi:application
Environment="DJANGO_SETTINGS_MODULE=config.settings.settings"
[Install]
WantedBy=multi-user.target

ì—¬ê¸°ì„œ ê°€ìƒí™˜ê²½ì„
pyenv virtualenv 3.13.1 wistar ì´ë ‡ê²Œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í–ˆìœ¼ë©´
/home/ubuntu/.pyenv/versions/wistar/bin/gunicorn
ì´ë ‡ê²Œ ì´ ë¶€ë¶„ë§Œ ë°”ê¾¸ë©´ ëœë‹¤.

# ì‹œìŠ¤í…œì„¤ì • daemon-reload
sudo systemctl daemon-reload

# gunicon.serviceë¥¼ ì‚¬ìš©ê°€ëŠ¥í•œ ì‹œìŠ¤í…œ ì„¤ì •ìœ¼ë¡œ ë“±ë¡
sudo systemctl enable gunicorn.service

# gunicornì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ /srvì— ëŒ€í•œ ê¶Œí•œ ì„¤ì •
sudo chmod 777 /srv

# /srv í•˜ìœ„ì— gunicorn ë””ë ‰í„°ë¦¬ ìƒì„±
mkdir /srv/gunicorn

# /var/log í•˜ìœ„ì— gunicorn ë””ë ‰í„°ë¦¬ ìƒì„±(ë¡œê·¸íŒŒì¼ ìƒì„±ì„ ìœ„í•´)
sudo mkdir /var/log/gunicorn

# /var/log/gunicorn ê¶Œí•œ ì„¤ì •
sudo chown -R ubuntu:ubuntu /var/log/gunicorn
sudo chmod -R 755 /var/log/gunicorn

# gunicorn ì„œë¹„ìŠ¤ ì‹¤í–‰
sudo systemctl start gunicorn.service

# gunicorn ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
sudo systemctl status gunicorn.service

requests ì—†ì–´ì„œ ì—ëŸ¬ ë°œìƒ
ê°€ìƒí™˜ê²½ í™œì„±í™” ìƒíƒœì—ì„œ í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install requests

Gunicorn ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sudo systemctl restart gunicorn.service

ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
sudo systemctl status gunicorn.service


### Nginx ì„¤ì¹˜ ë° ì„¤ì •í•˜ê¸°
- ì•„ë˜ì˜ ê°€ì´ë“œë¥¼ ë”°ë¼ nginx ì„¤ì •ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

# nginx íŒ¨í‚¤ì§€ ì„¤ì¹˜
sudo apt-get install software-properties-common
sudo apt-get install nginx

# nginx ì„¤ì • íŒŒì¼ì´ ìœ„ì¹˜í•œ ë””ë ‰í„°ë¦¬ë¡œ ì´ë™
cd /etc/nginx/sites-available
# ê¸°ë³¸ ì„¤ì •íŒŒì¼ ì œê±°
sudo rm default
# ìƒˆë¡œìš´ ì„¤ì •íŒŒì¼ ì¶”ê°€
sudo vi django.conf

# ì•„ë˜ì˜ ë‚´ìš©ì„ ì…ë ¥ í›„ :wq
server {
        server_name EC2ì˜ í¼ë¸”ë¦­ DNS;

        location /static/ {
				        root /home/ubuntu/í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í„°ë¦¬;
        }

        location /media/ {
				        root /home/ubuntu/í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í„°ë¦¬;
        }

        location / {
                include proxy_params;
                proxy_pass http://unix:/srv/gunicorn/gunicorn.sock;
        }
        listen 80;
}

# nginx ì„¤ì •íŒŒì¼ ì‹¬ë³¼ë¦­ ë§í¬ ì¶”ê°€
sudo ln -sf /etc/nginx/sites-available/django.conf /etc/nginx/sites-enabled/

# ê¸°ë³¸ ì„¤ì • ì‹¬ë³¼ë¦­ ë§í¬ ì œê±°
sudo rm /etc/nginx/sites-enabled/default

# nginx user ì„¤ì •
sudo vi /etc/nginx/nginx.conf
# ìƒë‹¨ì˜ 'user www-data'ë¥¼ 'user ubuntu'ë¡œ ë³€ê²½ í›„ :wq

# syetemctl ì„ ì‚¬ìš©í•˜ì—¬ nginx ì„œë¹„ìŠ¤ ì‹œì‘
sudo systemctl restart nginx.service

# syetemctl ì„ ì‚¬ìš©í•˜ì—¬ nginx ì„œë¹„ìŠ¤ ìƒíƒœí™•ì¸
sudo systemctl status nginx.service

Nginx ê´€ë ¨ ì„¤ì • íŒŒì¼ì„ ìˆ˜ì •í–ˆì„ ë•Œ
sudo systemctl daemon-reload

ê¹ƒì— ì´ë ‡ê²Œ ì»¤ë°‹ ë¡œê·¸ ì•ˆë‚¨ê¸°ê³  ìµœì‹  ì»¤ë°‹ì— í•©ì³¤ì„ ë•Œ
git add .
git commit --amend --no-edit
git push --force-with-lease origin feature/user

í˜„ì¬ ë¡œì»¬ ë¸Œëœì¹˜(prod/test2)ëŠ” ê·¸ ì´ì „ íˆìŠ¤í† ë¦¬ë¥¼ ê°€ì§€ê³  ìˆì–´ì„œ
Gitì´ ë³‘í•© ë°©ì‹(merge/rebase/fast-forward)ì„ ëª…í™•íˆ ì§€ì •í•´ì£¼ê¸¸ ìš”êµ¬
í•˜ì§€ë§Œ ê·¸ëƒ¥ ì›ê²© ë¸Œëœì¹˜ë¥¼ ê°•ì œ ì ìš©
git fetch origin
git reset --hard origin/prod/test2


SSL ì¸ì¦ì„œë¥¼ ì ìš©í•˜ì—¬ HTTPS ì„¤ì •í•˜ê¸°
certbot ì„¤ì¹˜
sudo apt-get install certbot python3-certbot-nginx

nginxì— ssl ì¸ì¦ì„œë¥¼ ì ìš©
sudo certbot --nginx -d example.com

ì²«ë²ˆì§¸ ì§ˆë¬¸ì€ ì„œë¹„ìŠ¤ ì‚¬ìš© ì•½ê´€ì— ëŒ€í•œ pdf íŒŒì¼ ìƒì„±ì—¬ë¶€ë¥¼ ë¬¼ì–´ë³´ëŠ” ê²ƒì´ê³ ,
ë‘ë²ˆì§¸ ì§ˆë¬¸ì€ ë„ë©”ì¸ ì¸ì¦ì— ì„±ê³µí•˜ë©´ í•´ë‹¹ ì´ìŠˆë¥¼ ì´ë©”ì¼ë¡œ ê³µìœ í•˜ê³ 
ì´ë©”ì¼ì„ í†µí•´ certbotê³¼ ê´€ë ¨ëœ ë‰´ìŠ¤, ìº í˜ì¸ ë“±ì„ ìˆ˜ì‹ ë°›ì„ ê²ƒì¸ì§€ ë™ì˜ì—¬ë¶€ì…ë‹ˆë‹¤.

ëª¨ë‘ ë™ì˜í•˜ê³  ë‚œ í›„ certbotì˜ ë„ë©”ì¸ ì¸ì¦ê³¼ì •ì„ í†µê³¼í•˜ì˜€ë‹¤ë©´
/etc/letsencrpyt/live/ë„ë©”ì¸ ê²½ë¡œ í•˜ìœ„ì— 4ê°œì˜ pem í‚¤ê°€ ìƒì„±ë©ë‹ˆë‹¤.

Let's Encrypt ì¸ì¦ì„œëŠ” 90ì¼ ë™ì•ˆë§Œ ìœ íš¨í•©ë‹ˆë‹¤.
ì¸ì¦ì„œë¥¼ ìë™ìœ¼ë¡œ ê°±ì‹ í•˜ë„ë¡ ì„¤ì •í•˜ë ¤ë©´ cronì„ ì´ìš©í•´ ìë™ ê°±ì‹ ì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.
certbotì€ ìë™ ê°±ì‹ ì„ ìœ„í•œ ì„¤ì •ì´ ê¸°ë³¸ì ìœ¼ë¡œ ë˜ì–´ ìˆì§€ë§Œ,
ì•„ë˜ ì»¤ë§¨ë“œë¡œ ê°±ì‹ ì´ ì˜ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
sudo certbot renew --dry-run

------------------------------------------
ì•„ë§ˆì¡´ ë¦¬ëˆ…ìŠ¤ ì„œë²„ì—ì„œ ë„ì»¤ ì‚¬ìš©í•´ ë°°í¬ ì„¤ì •í•˜ê¸°
------------------------------------------

# docker ì´ë¯¸ì§€ ìƒì„± ë° í…ŒìŠ¤íŠ¸
# docker build : Dockerfileì„ ê¸°ë°˜ìœ¼ë¡œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œ
# -tëŠ” ì´ë¯¸ì§€ì— íƒœê·¸(ì´ë¦„)ì„ ì§€ì •í•˜ëŠ” ì˜µì…˜
# í˜„ì¬ ë””ë ‰í† ë¦¬(.)ë¥¼ ë¹Œë“œ ì»¨í…ìŠ¤íŠ¸ë¡œ ì§€ì •
docker build -t wistar_backend ./resources/docker
# ì‹¤í–‰
docker run wistar_backend


ë„ì»¤ ì„¤ì¹˜ -y ëª¨ë“  ì§ˆë¬¸ yes
sudo yum install -y docker
ë„ì»¤ ì„¤ì¹˜ í™•ì¸
docker --version
Docker ë°ëª¬(ì„œë²„)ì„ ìˆ˜ë™ìœ¼ë¡œ ì§€ê¸ˆ ë°”ë¡œ ì‹¤í–‰. ì´ê±¸ í•˜ì§€ ì•Šìœ¼ë©´ docker runì„ í•´ë„ ë™ì‘í•˜ì§€ ì•ŠìŒ.
sudo systemctl start docker
ì„œë²„ë¥¼ ê»ë‹¤ ì¼œë„ Docker ì„œë¹„ìŠ¤ê°€ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ì‹œì‘ë˜ê²Œ ì„¤ì •
sudo systemctl enable docker
ssh -i ~/Downloads/wistar.pem ec2-user@3.39.10.22
ssh -i ~/Downloads/wistar.pem ubuntu@43.203.181.6

sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

sudo chmod +x /usr/local/bin/docker-compose

docker-compose --version


mv ~/Downloads/wistar.pem ~/.ssh
ls -l

chmod 400 wistar.pem   # ì½ê¸° ëª¨ë“œ ì„¤ì •
ls -l

ssh -i ~/.ssh/wistar.pem ec2-user@13.124.181.116
ssh -i ~/.ssh/wistar.pem ubuntu@43.203.181.6


1. scp&docker-compose
2. GitHub & docker-compose  (ë³´ì•ˆìœ„í˜‘)
3. docker build

ì„œë²„ì— í”„ë¡œì íŠ¸ ë³µì‚¬

ê¹ƒ í´ë¡ 
git clone ë¦¬íŒŒì§“í† ë¦¬

ì—…ë°ì´íŠ¸
git fetch origin

ë°°í¬ìš© ë¸Œëœì¹˜ë¡œ ì´ë™
git checkout -b test/prod origin/test/prod

í”„ë¡œì íŠ¸ ê²½ë¡œì—ì„œ ëª…ë ¹ì–´ ì…ë ¥
scp -i ~/.ssh/mykey02.pem -r . ec2-user@13.124.181.116:~/app

# docker-compose: ë„ì»¤ ì»´í¬ì¦ˆ ì‹¤í–‰ ëª…ë ¹ì–´ (ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë¥¼ ì •ì˜í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë„êµ¬)
# -f docker-compose-prod.yml: ì‚¬ìš©í•  ì„¤ì • íŒŒì¼ì„ ëª…ì‹œì ìœ¼ë¡œ ì§€ì • (docker-compose.ymlì´ ì•„ë‹Œ ë‹¤ë¥¸ íŒŒì¼ì„ ì§€ì •í•  ë•Œ í•„ìš”)
# up: ì»¨í…Œì´ë„ˆë¥¼ ìƒì„± ë° ì‹¤í–‰í•˜ëŠ” ëª…ë ¹
# -d: ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ (í„°ë¯¸ë„ ì ìœ  X)
sudo docker-compose -f docker-compose-prod.yml up -d

connect: permission denied ì´ëŸ° ì˜¤ë¥˜ ëœ° ì‹œ
ec2-userë¥¼ docker ê·¸ë£¹ì— ì¶”ê°€ í›„ ec2ì„œë²„ ì¬ì ‘ì†
sudo usermod -aG docker ec2-user

sudo docker ps

ec2 ì„œë²„ì•ˆì˜ ë„ì»¤ ì´ë¯¸ì§€ì— ì ‘ì†
sudo docker exec -it instagram_backend bash

í™˜ê²½ë³€ìˆ˜ í™•ì¸
echo $DJANGO_SETTINGS_MODULE

python3 manage.py makemigrations

python3 manage.py migrate

python3 manage.py createsuperuser



ì»¨í…Œì´ë„ˆ ì •ì§€ ë° ì œê±°
sudo docker-compose -f docker-compose-prod.yml down

ë³€ê²½ì‚¬í•­ ë°˜ì˜í•˜ì—¬ ì¬ë¹Œë“œ ë° ì¬ì‹¤í–‰
sudo docker-compose -f docker-compose-prod.yml up --build -d

ì„œë²„ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì†
docker exec -it wistar_db psql -U postgres -d oz_project

ì •ì  íŒŒì¼ ìˆ˜ì§‘
python manage.py collectstatic --noinput

# (ì¶”ê°€) í•„ìš”í•œ ê²½ìš° pip ì—…ê·¸ë ˆì´ë“œ
sudo python3 -m ensurepip --upgrade

ë„ì»¤ ì»¨í…Œì´ë„ˆ í„°ë¯¸ë„ ì‹¤í–‰
sudo docker exec -it wistarback bash


nginx ì„¤ì¹˜ (Amazon Linux 2ìš©)
sudo yum update -y
sudo yum install nginx -y
ì„¤ì¹˜í™•ì¸
nginx -v

2ë‹¨ê³„: nginx ì‹œì‘
sudo systemctl start nginx
sudo systemctl enable nginx

3ë‹¨ê³„: nginx ì„¤ì • íŒŒì¼ ë§Œë“¤ê¸°
sudo vi /etc/nginx/conf.d/wistarback.conf

ë³µë¶™
server {
    listen 80;
    server_name _;  # ì¼ë‹¨ ëª¨ë“  ìš”ì²­ í—ˆìš©

    # Static íŒŒì¼ ìš”ì²­ ì²˜ë¦¬
    location /static/ {
        alias /WiStarBack/.static_root/;
    }

    # Django ë°±ì—”ë“œ ìš”ì²­ì€ Gunicorn(8000í¬íŠ¸)ìœ¼ë¡œ ë„˜ê¸°ê¸°
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

4ë‹¨ê³„: nginx ì¬ì‹œì‘
sudo nginx -t
sudo systemctl reload nginx

5ë‹¨ê³„: ë°©í™”ë²½(ë³´ì•ˆ ê·¸ë£¹) í™•ì¸

6ë‹¨ê³„: ìµœì¢… í™•ì¸

.static_root í´ë” ì „ì†¡
scp -i ~/Downloads/your-key.pem -r .static_root/ ec2-user@3.39.10.22:/home/ec2-user/WiStarBack/
scp -i ~/Downloads/wistar.pem -r .static_root/ ec2-user@3.39.10.22:/home/ec2-user/WiStarBack/

server {
    listen 80;
    server_name _;

    location /static/ {
        alias /home/ec2-user/WiStarBack/.static_root/;
        access_log off;
        expires max;
    }

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

ì—ëŸ¬ ë¡œê·¸ í™•ì¸
sudo tail -n 100 /var/log/nginx/error.log

ê¶Œí•œ ìˆ˜ì •
sudo chmod -R 755 /home/ec2-user/WiStarBack/.static_root
sudo nginx -t
sudo systemctl reload nginx

nginx ê¶Œí•œ ì„¤ì •
sudo chown -R nginx:nginx /home/ec2-user/WiStarBack/.static_root
sudo systemctl reload nginx

nginx ê¶Œí•œ ì„¤ì •
sudo chmod +x /home
sudo chmod +x /home/ec2-user
sudo chmod +x /home/ec2-user/WiStarBack
sudo chmod +x /home/ec2-user/WiStarBack/.static_root


http://3.39.10.22/redoc/
http://3.39.10.22/swagger/


ì»¤ë°‹ ë¡œê·¸ ì•ˆë‚¨ê¸°ê³  ìµœì‹  ì»¤ë°‹ì— í•©ì¹˜ëŠ”ë²•
git add .
git commit --amend --no-edit
git push --force-with-lease origin feature/user

í•´ë‹¹ ì»¤ë°‹ê¹Œì§€ ìƒíƒœë¥¼ ë˜ëŒë¦¬ë˜, ì‘ì—… ë‚´ìš©ì€ staging ìƒíƒœ(index)ì— ìœ ì§€
git reset --soft í•´ì‹œì½”ë“œ


ë¸Œëœì¹˜ íŠ¸ë™í‚¹ ì„¤ì • í™•ì¸
git branch -vv

ë¸Œëœì¹˜ íŠ¸ë™í‚¹ ì„¤ì •
git branch --set-upstream-to=origin/develop develop

ì´í›„ íŠ¸ë™í‚¹ ì„¤ì •ëœ ë¸Œëœì¹˜ pull ê°€ëŠ¥


ì‘ì—…ì€ ë³‘ë ¬ë¡œ, ë¸Œëœì¹˜ ìµœì‹ í™”ëŠ” ë‚˜ì¤‘ì—
ì‘ì—…ì„ ë¯¸ë¦¬ ì‹œì‘í•˜ê³ , ë‚˜ì¤‘ì— develop ë¨¸ì§€ê°€ ëë‚œ í›„ ìµœì‹  developì„ ë°˜ì˜(rebase or merge)

ğŸ“Œ 1. ì§€ê¸ˆ ë‹¹ì¥ ì‘ì—…ì„ ì‹œì‘í•˜ëŠ” ë°©ë²•
# ìµœì‹  develop ê¸°ì¤€ì´ ì•„ì§ merge ì•ˆ ë˜ì—ˆë”ë¼ë„
git checkout -b feature/my-task
# ì—¬ê¸°ì„œ ë°”ë¡œ ì‘ì—… ì‹œì‘ ê°€ëŠ¥
ì´ ì‹œì ì—ì„œëŠ” *"êµ¬-develop ê¸°ì¤€"*ìœ¼ë¡œ ì‘ì—…ì´ ì‹œì‘ë©ë‹ˆë‹¤.
ìƒê´€ì—†ìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ìµœì‹ í™”ë§Œ ì˜ í•˜ë©´ ë©ë‹ˆë‹¤.

ğŸ“Œ 2. developì´ ì™„ì „íˆ mergeëœ í›„ ìµœì‹ í™”í•˜ëŠ” ë°©ë²•
git fetch origin
git checkout feature/my-task
git rebase origin/develop  # ë˜ëŠ” git merge origin/develop
ì´ ê³¼ì •ì—ì„œ ì¶©ëŒì´ ë‚˜ë©´ í•´ê²°í•˜ë©´ ë˜ê³ ,
ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ê¹”ë”í•˜ê²Œ ìµœì‹  develop ê¸°ë°˜ìœ¼ë¡œ ì‘ì—…ì„ ì´ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ“Œ 3. ì´í›„ ì •ìƒì ìœ¼ë¡œ PR ë³´ë‚´ê¸°
git push origin feature/my-task
# ê·¸ë¦¬ê³  PR ë³´ë‚´ê¸°


ë§ˆì´ê·¸ë ˆì´ì…˜ ê¼¬ì˜€ì„ ë•Œ
# ëª¨ë“  ë§ˆì´ê·¸ë ˆì´ì…˜ ì‚­ì œ (ì£¼ì˜!)
find . -path "*/migrations/*.py" -not -name "__init__.py" -delete
find . -path "*/migrations/*.pyc"  -delete

# ìƒˆë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
python manage.py makemigrations

# ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
python manage.py migrate


ì›ê²© ë¸Œëœì¹˜ ê°€ì ¸ì˜¤ê¸°
# 1. ì›ê²© ë¸Œëœì¹˜ ëª©ë¡ í™•ì¸í•˜ê¸°
git fetch  # ì›ê²© ë¸Œëœì¹˜ ì •ë³´ ìµœì‹ í™”
git branch -r  # ì›ê²© ë¸Œëœì¹˜ ëª©ë¡ ì¡°íšŒ

# 2. íŠ¹ì • ì›ê²© ë¸Œëœì¹˜ë¥¼ ë¡œì»¬ë¡œ ê°€ì ¸ì˜¤ê¸° (ì²´í¬ì•„ì›ƒ)
git checkout -b <ë¡œì»¬ë¸Œëœì¹˜ëª…> origin/<ì›ê²©ë¸Œëœì¹˜ëª…>


ì„œë²„ì— ë³€ê²½ ì‚¬í•­ ì ìš©
git pull origin main
sudo systemctl restart gunicorn
sudo systemctl reload nginx

# gunicorn ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
sudo systemctl status gunicorn
sudo systemctl status nginx


ë¡œì»¬ ë³€ê²½ì‚¬í•­ ì œì™¸í•˜ê³  ì›ê²© ë¦¬íŒŒì§í† ë¦¬ ì ìš©
# 1. ë³€ê²½ì‚¬í•­ ì„ì‹œ ì €ì¥ (ì»¤ë°‹ ì•ˆ í•´ë„ ë¨)
git stash push -m "temp"

# 2. ë‹¤ë¥¸ ë¸Œëœì¹˜ë¡œ ì´ë™
git checkout prod/test2

# 3. prod/develop ì‚­ì œ
git branch -D prod/develop

# 4. ì›ê²© ê¸°ì¤€ìœ¼ë¡œ ë‹¤ì‹œ ìƒì„±
git fetch origin
git checkout -b prod/develop origin/prod/develop

# ë³€ê²½ì‚¬í•­ ë‹¤ì‹œ ì ìš©í•˜ê³  ì‹¶ë‹¤ë©´
git stash pop

# í•„ìš” ì—†ë‹¤ë©´ ë²„ë¦¬ê¸°
git stash drop
# ë˜ëŠ”
git stash clear  # ëª¨ë“  stash ì œê±°


# ì›í•˜ëŠ” ë³€ê²½ì‚¬í•­ë§Œ ì ìš©
git merge develop --no-commit --no-ff

develop ë¸Œëœì¹˜ì— prì ìš©í•  ë•Œ ì›í•˜ëŠ” ëŒ€ìƒë§Œ ì ìš©í•˜ê³  ì‹¶ìœ¼ë©´
git checkout develop  # ë³‘í•© ëŒ€ìƒ ë¸Œëœì¹˜
git fetch origin pull/36/head:pr-36  #prì„ ë¶ˆëŸ¬ì˜´
git merge pr-36 --no-commit --no-ff

ì›í•˜ëŠ” íŒŒì¼ ì ìš© ë° í•´ì œ
git restore --staged apps/user_schedule/migrations/000X_*.py
git restore apps/user_schedule/migrations/000X_*.py

ë‚˜ë¨¸ì§€ ë³€ê²½ ì‚¬í•­ë§Œ ì»¤ë°‹
git add .
git commit -m "PR #36 ìˆ˜ë™ ë³‘í•© (ë§ˆì´ê·¸ë ˆì´ì…˜ ì œì™¸)"

ì›ê²© ë¸Œëœì¹˜ì— ì ìš©
git push



ë„ì»¤ ì»¨í…Œì´ë„ˆ ì ‘ì†
docker exec -it wistarback bash


ë„ì»¤ ì»¨í…Œì´ë„ˆ db ì ‘ì†
docker exec -it wistar_db psql -U postgres -d oz_project

í…Œì´ë¸” ëª©ë¡
\dt

ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë¡œì»¬ ë¸Œëœì¹˜ì— ì›ê²© ë¸Œëœì¹˜ ì¶”ì  ì„¤ì •
git branch --set-upstream-to=origin/<ì›ê²©ë¸Œëœì¹˜ëª…> <ë¡œì»¬ë¸Œëœì¹˜ëª…>


gunicorn ì„œë²„ ë¡œê·¸ í™•ì¸
sudo journalctl -u gunicorn.service -n 50 --no-pager

pyenv virtualenv 3.13.1 wistar
pyenv local wistar
ì¸í„°í”„ë¦¬í„° ì„¤ì • (ì„¤ì •ì‹œ ê°€ìƒí™˜ê²½ ìë™ í™œì„±í™”)


í˜„ì¬ poetryê°€ ì‚¬ìš©ì¤‘ì¸ ê°€ìƒí™˜ê²½ ê²½ë¡œ í™•ì¸
poetry env info --path

í˜„ì¬ í”„ë¡œì íŠ¸ê°€ ì‚¬ìš©ì¤‘ì¸ poetry ê°€ìƒí™˜ê²½ ë¦¬ìŠ¤íŠ¸
poetry env list

poetryì—ì„œ ìë™ ìƒì„±ëœ ê°€ìƒí™˜ê²½ ìœ„ì¹˜
cd /Users/taejin/Library/Caches/pypoetry/virtualenvs/

poetry ê°€ìƒí™˜ê²½ ê°•ì œ ì‚­ì œ
rm -rf /Users/taejin/Library/Caches/pypoetry/virtualenvs/myfavidolback-QFqDp6Nl-py3.13


# ìë™ ë°°í¬ ì„¤ì •ì‹œ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ì„¤ì •í•˜ëŠ”ê²Œ í¸í•˜ë‹¤
# local ì‹¬ë³¼ë¦­ ë§í¬ ìƒì„±

í”„ë¡œì íŠ¸ ê²½ë¡œì—ì„œ ì‹¤í–‰
ln -sf $(pwd)/config/settings/local.py $(pwd)/config/settings/settings.py

ê²½ë¡œì— ë“¤ì–´ê°€ì„œ ì‹¤í–‰
cd config/settings
ln -sf local.py settings.py

# ìš´ì˜ ì„œë²„ì—ì„œë§Œ ì‹¤í–‰
ln -sf $(pwd)/config/urls/urls_prod.py $(pwd)/config/urls/urls.py
# ë¡œì»¬ ê°œë°œì—ì„œëŠ”
ln -sf $(pwd)/config/urls/urls_dev.py $(pwd)/config/urls/urls.py


ë¡œì»¬ ê°œë°œ ì„œë²„(runserver):
DEBUG = Trueì¼ ë•ŒëŠ” ALLOWED_HOSTS ê²€ì‚¬ë¥¼ ê±°ì˜ í•˜ì§€ ì•ŠìŒ
ê·¸ë˜ì„œ []ì´ë”ë¼ë„ ì •ìƒ ì‘ë™

ì„œë²„ (Gunicorn + Nginx ë“±):
manage.py runserverê°€ ì•„ë‹ˆë¼ WSGI ì„œë²„ë¥¼ í†µí•´ ë°°í¬ë˜ë©´
DjangoëŠ” ALLOWED_HOSTSë¥¼ ì—„ê²©í•˜ê²Œ ê²€ì‚¬í•¨
DEBUG = Trueë¼ë„ ë¬´ì¡°ê±´ ALLOWED_HOSTSì— í¬í•¨ë˜ì–´ ìˆì–´ì•¼ í•¨


ì¥ê³  ì‹œí¬ë¦¿ í‚¤ ìƒì„± ëª…ë ¹ì–´
python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'
